name: Periodic Health Check

on: 
  schedule:
    - cron: '*/5 * * * *' #every 5min
  push:
    branches:
      - master
  
jobs:

  start-server:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '16'
      - name: npm install
        run: npm install
      - name: build
        run: npm run build
      - name: start srvr
        run: npm run start-prod

  wait-on-server:
    runs-on: ubuntu-20.04
    steps: 
      - run: sleep 120s
        shell: bash

  periodic-healthcheck:
    needs: [wait-on-server]
    runs-on: ubuntu-20.04
    steps:
      - uses: fjogeleit/http-request-action@v1
        with:
          url: 'http://localhost:5000/health'
          method: 'GET'
      #- uses: jtalk/url-health-check-action@v3
        #with:
          #url: https://fullstackopen-pokedex.onrender.com/health
     